<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>管理后台 - 首页</title>
    <!-- Element Plus CSS -->
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
    <!-- Element Plus Icons -->
    <link rel="stylesheet" href="https://unpkg.com/@element-plus/icons-vue/dist/index.css">
    <!-- 自定义样式 -->
    <link rel="stylesheet" th:href="@{/css/styles.css}">
</head>
<body>
    <div id="app">
        <div class="layout-container">
            <!-- 顶部导航栏 -->
            <el-header class="header" height="60px">
                <el-row justify="space-between" align="middle" style="height: 100%;">
                    <el-col :span="12">
                        <el-row align="middle">
                            <el-button 
                                :icon="collapsed ? 'Expand' : 'Fold'" 
                                @click="toggleSidebar"
                                text
                                style="margin-right: 15px;">
                            </el-button>
                            <h2 style="margin: 0; color: var(--text-primary); font-weight: 600;">管理后台</h2>
                        </el-row>
                    </el-col>
                    <el-col :span="12">
                        <el-row justify="end" align="middle">
                            <el-badge :value="5" class="item" style="margin-right: 20px;">
                                <el-button :icon="'Bell'" circle></el-button>
                            </el-badge>
                            <el-dropdown>
                                <el-avatar :size="35" src="https://cube.elemecdn.com/0/88/03b0d39583f48206768a7534e55bcpng.png"></el-avatar>
                                <template #dropdown>
                                    <el-dropdown-menu>
                                        <el-dropdown-item :icon="'User'">个人中心</el-dropdown-item>
                                        <el-dropdown-item :icon="'Setting'">系统设置</el-dropdown-item>
                                        <el-dropdown-item divided :icon="'SwitchButton'">退出登录</el-dropdown-item>
                                    </el-dropdown-menu>
                                </template>
                            </el-dropdown>
                        </el-row>
                    </el-col>
                </el-row>
            </el-header>

            <div class="main-container">
                <!-- 侧边栏菜单 - 通过include引入 -->
                <div th:replace="~{layout/sidebar :: sidebar}"></div>

                <!-- 主要内容区域 -->
                <el-main class="content-area">
                    <!-- 欢迎区域 -->
                    <div class="welcome-section">
                        <h1 style="margin: 0 0 10px 0;">欢迎回来！</h1>
                        <p style="margin: 0; opacity: 0.9;">今天是 {{ currentDate }}，祝您工作愉快！</p>
                    </div>

                    <!-- 数据统计卡片 -->
                    <el-row :gutter="20" style="margin-bottom: 20px;">
                        <el-col :xs="24" :sm="12" :md="6">
                            <el-card class="stats-card">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <div class="stats-label">总用户数</div>
                                        <div class="stats-number">{{ stats.totalUsers }}</div>
                                    </div>
                                    <el-icon size="40" class="action-icon"><User /></el-icon>
                                </div>
                            </el-card>
                        </el-col>
                        
                        <el-col :xs="24" :sm="12" :md="6">
                            <el-card class="stats-card success">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <div class="stats-label">今日访问</div>
                                        <div class="stats-number">{{ stats.todayVisits }}</div>
                                    </div>
                                    <el-icon size="40" class="action-icon"><View /></el-icon>
                                </div>
                            </el-card>
                        </el-col>
                        
                        <el-col :xs="24" :sm="12" :md="6">
                            <el-card class="stats-card warning">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <div class="stats-label">总订单数</div>
                                        <div class="stats-number">{{ stats.totalOrders }}</div>
                                    </div>
                                    <el-icon size="40" class="action-icon"><ShoppingCart /></el-icon>
                                </div>
                            </el-card>
                        </el-col>
                        
                        <el-col :xs="24" :sm="12" :md="6">
                            <el-card class="stats-card info">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <div class="stats-label">总收入</div>
                                        <div class="stats-number">¥{{ stats.totalRevenue }}</div>
                                    </div>
                                    <el-icon size="40" class="action-icon"><Money /></el-icon>
                                </div>
                            </el-card>
                        </el-col>
                    </el-row>

                    <!-- 快捷操作 -->
                    <el-row :gutter="20" style="margin-bottom: 20px;">
                        <el-col :span="24">
                            <h3 class="section-title">快捷操作</h3>
                            <div class="quick-actions">
                                <div class="action-card" @click="handleQuickAction('addUser')">
                                    <el-icon size="30" :color="'var(--primary-color)'" class="action-icon"><UserFilled /></el-icon>
                                    <div class="action-title">添加用户</div>
                                    <div class="action-desc">快速添加新用户</div>
                                </div>
                                
                                <div class="action-card" @click="handleQuickAction('addArticle')">
                                    <el-icon size="30" :color="'var(--success-color)'" class="action-icon"><EditPen /></el-icon>
                                    <div class="action-title">发布文章</div>
                                    <div class="action-desc">创建新的文章内容</div>
                                </div>
                                
                                <div class="action-card" @click="handleQuickAction('viewReports')">
                                    <el-icon size="30" :color="'var(--warning-color)'" class="action-icon"><TrendCharts /></el-icon>
                                    <div class="action-title">查看报表</div>
                                    <div class="action-desc">查看详细数据报表</div>
                                </div>
                                
                                <div class="action-card" @click="handleQuickAction('systemSettings')">
                                    <el-icon size="30" :color="'var(--info-color)'" class="action-icon"><Tools /></el-icon>
                                    <div class="action-title">系统设置</div>
                                    <div class="action-desc">配置系统参数</div>
                                </div>
                            </div>
                        </el-col>
                    </el-row>

                    <!-- 图表和最近活动 -->
                    <el-row :gutter="20">
                        <el-col :xs="24" :lg="16">
                            <div class="chart-container">
                                <h3 class="section-title">访问趋势</h3>
                                <div id="visitChart" style="height: 300px; display: flex; align-items: center; justify-content: center; color: var(--text-tertiary);">
                                    <div style="text-align: center;">
                                        <el-icon size="60" :color="'var(--border-base)'"><TrendCharts /></el-icon>
                                        <div style="margin-top: 12px; color: var(--text-secondary);">图表数据加载中...</div>
                                        <div style="font-size: 12px; margin-top: 8px; color: var(--text-tertiary);">可集成 ECharts 或其他图表库</div>
                                    </div>
                                </div>
                            </div>
                        </el-col>
                        
                        <el-col :xs="24" :lg="8">
                            <div class="recent-activities">
                                <h3 class="section-title">最近活动</h3>
                                <el-timeline>
                                    <el-timeline-item
                                        v-for="activity in recentActivities"
                                        :key="activity.id"
                                        :timestamp="activity.time"
                                        :color="activity.color">
                                        {{ activity.content }}
                                    </el-timeline-item>
                                </el-timeline>
                            </div>
                        </el-col>
                    </el-row>
                </el-main>
            </div>
        </div>
    </div>

    <!-- Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Element Plus -->
    <script src="https://unpkg.com/element-plus/dist/index.full.js"></script>
    <!-- Element Plus Icons -->
    <script src="https://unpkg.com/@element-plus/icons-vue/dist/index.iife.min.js"></script>

    <script>
        const { createApp, ref, computed, onMounted } = Vue;
        const { ElMessage } = ElementPlus;

        const app = createApp({
            setup() {
                const collapsed = ref(false);
                const menuItems = ref([]);
                
                const stats = ref({
                    totalUsers: '12,345',
                    todayVisits: '1,234',
                    totalOrders: '5,678',
                    totalRevenue: '123,456'
                });

                const recentActivities = ref([
                    {
                        id: 1,
                        content: '用户张三注册了账号',
                        time: '2024-01-15 14:30',
                        color: 'var(--primary-color)'
                    },
                    {
                        id: 2,
                        content: '发布了新文章《Vue 3 最佳实践》',
                        time: '2024-01-15 13:45',
                        color: 'var(--success-color)'
                    },
                    {
                        id: 3,
                        content: '系统进行了安全更新',
                        time: '2024-01-15 12:00',
                        color: 'var(--warning-color)'
                    },
                    {
                        id: 4,
                        content: '备份任务执行完成',
                        time: '2024-01-15 10:30',
                        color: 'var(--text-tertiary)'
                    }
                ]);

                const currentDate = computed(() => {
                    return new Date().toLocaleDateString('zh-CN', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric',
                        weekday: 'long'
                    });
                });

                const toggleSidebar = () => {
                    collapsed.value = !collapsed.value;
                };

                const handleQuickAction = (action) => {
                    const actions = {
                        addUser: '添加用户',
                        addArticle: '发布文章',
                        viewReports: '查看报表',
                        systemSettings: '系统设置'
                    };
                    
                    ElMessage({
                        message: `点击了 ${actions[action]} 功能`,
                        type: 'success'
                    });
                };

                // 处理菜单点击事件
                const handleMenuClick = (menuItem) => {
                    if (menuItem.url) {
                        ElMessage({
                            message: `跳转到: ${menuItem.name} (${menuItem.url})`,
                            type: 'info'
                        });
                        // 这里可以添加路由跳转逻辑
                        // window.location.href = menuItem.url;
                    }
                };

                // 加载菜单配置
                const loadMenuConfig = async () => {
                    try {
                        const response = await fetch('/config/menu.json');
                        const data = await response.json();
                        menuItems.value = data.menuItems;
                    } catch (error) {
                        console.error('加载菜单配置失败:', error);
                        ElMessage({
                            message: '菜单配置加载失败',
                            type: 'error'
                        });
                    }
                };

                // 组件挂载时加载数据
                onMounted(() => {
                    loadMenuConfig();
                    console.log('管理后台首页已加载');
                });

                return {
                    collapsed,
                    menuItems,
                    stats,
                    recentActivities,
                    currentDate,
                    toggleSidebar,
                    handleQuickAction,
                    handleMenuClick
                };
            }
        });

        app.use(ElementPlus);
        
        // 注册所有图标
        if (typeof ElementPlusIconsVue !== 'undefined') {
            for (const [key, component] of Object.entries(ElementPlusIconsVue)) {
                app.component(key, component);
            }
        } else {
            console.error('ElementPlusIconsVue 未正确加载');
        }
        
        app.mount('#app');
    </script>
</body>
</html>